<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RAG Ingestion - Upload File</title>
  <style>
    :root{
      --bg: #0b1220;
      --panel: #0f172a;
      --muted: #94a3b8;
      --text: #e2e8f0;
      --primary: #3b82f6;
      --primary-600: #2563eb;
      --ring: rgba(59,130,246,0.4);
      --border: #1f2937;
      --success: #16a34a;
      --error: #ef4444;
      --code-bg: #0b1020;
    }
    @media (prefers-color-scheme: light) {
      :root{
        --bg: #f8fafc;
        --panel: #ffffff;
        --muted: #475569;
        --text: #0f172a;
        --primary: #2563eb;
        --primary-600: #1d4ed8;
        --ring: rgba(37,99,235,0.35);
        --border: #e5e7eb;
        --code-bg: #0b1020;
      }
    }
    *{ box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; display: grid; place-items: center; min-height: 100vh;
      background: radial-gradient(1200px 800px at 20% 10%, rgba(59,130,246,0.12), transparent 60%),
                  radial-gradient(900px 700px at 80% 20%, rgba(99,102,241,0.10), transparent 60%),
                  var(--bg);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      line-height: 1.5;
      padding: 2rem 1rem;
    }
    .card {
      width: 100%; max-width: 720px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.0)) , var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15), inset 0 1px 0 rgba(255,255,255,0.03);
      padding: 1.5rem 1.75rem;
      backdrop-filter: saturate(140%) blur(10px);
    }
    header { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem; }
    header .badge { font-size: 0.8rem; color: var(--muted); padding: 0.2rem 0.5rem; border: 1px solid var(--border); border-radius: 999px; }
    h1 { margin: 0; font-size: 1.4rem; letter-spacing: 0.2px; }
    p.lead { margin: 0.25rem 0 1rem 0; color: var(--muted); }

    form { margin-top: 0.5rem; }
    .field { display: grid; gap: 0.5rem; margin: 1rem 0; }
    label { font-weight: 600; letter-spacing: 0.2px; }
    input[type="file"] {
      width: 100%;
      background: transparent;
      color: var(--text);
      border: 1px dashed var(--border);
      border-radius: 12px;
      padding: 0.9rem;
      transition: border-color .2s ease, box-shadow .2s ease;
    }
    input[type="file"]:focus-visible {
      outline: none; border-color: var(--primary);
      box-shadow: 0 0 0 4px var(--ring);
    }
    .actions { display: flex; gap: 0.75rem; align-items: center; }
    button {
      background: linear-gradient(180deg, var(--primary), var(--primary-600));
      color: white; border: 0; padding: 0.7rem 1.1rem; border-radius: 12px; cursor: pointer;
      font-weight: 600; letter-spacing: 0.2px; box-shadow: 0 6px 18px rgba(37,99,235,0.25);
      transition: transform .06s ease, filter .2s ease, box-shadow .2s ease;
    }
    button:hover { filter: brightness(1.05); box-shadow: 0 8px 22px rgba(37,99,235,0.30); }
    button:active { transform: translateY(1px); }
    button:disabled { background: linear-gradient(180deg, #7c8599, #6b7280); box-shadow: none; cursor: not-allowed; }
    .note { font-size: 0.9rem; color: var(--muted); }
    .hr { height: 1px; background: var(--border); border: 0; margin: 1.25rem 0; }
    .status { font-size: 0.9rem; margin-top: 0.5rem; }
    .status.ok { color: var(--success); }
    .status.err { color: var(--error); }
    pre { background: var(--code-bg); color: #e5e7eb; padding: 0.9rem; border-radius: 12px; overflow: auto; border: 1px solid #111827; }
    code { background: rgba(148,163,184,0.12); padding: 0.1rem 0.3rem; border-radius: 6px; }
    footer { margin-top: 1.25rem; font-size: 0.85rem; color: var(--muted); display: flex; gap: .5rem; align-items: center; }
  </style>
</head>
<body>
  <div class="card" role="region" aria-labelledby="title">
    <header>
      <span class="badge">Upload</span>
      <h1 id="title">Upload a document</h1>
    </header>

    <form id="uploadForm" novalidate>
      <div class="field">
        <label for="file">Choose file</label>
        <div class="file-upload" style="display:flex; align-items:center; gap:.6rem;">
          <input id="file" name="file" type="file" accept=".txt,.md,.pdf,.docx" required aria-required="true" style="position:absolute; left:-9999px;" />
          <button id="chooseBtn" type="button" aria-label="Choose file" style="background:linear-gradient(180deg, var(--primary), var(--primary-600)); color:#fff; border:0; padding:.6rem .9rem; border-radius:10px; cursor:pointer; font-weight:600; box-shadow:0 6px 18px rgba(37,99,235,0.25);">Choose file</button>
          <span id="fileName" style="color:var(--muted);">No file chosen</span>
        </div>
      </div>
      <div class="actions">
        <button id="submitBtn" type="submit" aria-live="polite">Upload & Ingest</button>
        <span id="status" class="status" aria-live="polite"></span>
      </div>
      
    </form>

    <hr class="hr" />
    <h2>Result</h2>
    <pre id="output">(no response yet)</pre>
    
  </div>

  <script>
    const form = document.getElementById('uploadForm');
    const output = document.getElementById('output');
    const submitBtn = document.getElementById('submitBtn');
    const statusEl = document.getElementById('status');
    const chooseBtn = document.getElementById('chooseBtn');
    const fileInput = document.getElementById('file');
    const fileNameEl = document.getElementById('fileName');

    chooseBtn.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', () => {
      const f = fileInput.files?.[0];
      fileNameEl.textContent = f ? f.name : 'No file chosen';
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      output.textContent = 'Uploading...';
      statusEl.textContent = '';
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Uploadingâ€¦';
      submitBtn.disabled = true;

      try {
        const fd = new FormData();
        const file = document.getElementById('file').files[0];
        if (!file) { throw new Error('Please choose a file.'); }
        fd.append('file', file);

        const base = window.location.origin;
        const res = await fetch(`${base}/ingest/file`, {
          method: 'POST',
          body: fd
        });
        const text = await res.text();
        statusEl.className = 'status ' + (res.ok ? 'ok' : 'err');
        statusEl.textContent = res.ok ? 'Upload successful' : `Upload failed (${res.status})`;
        try {
          const json = JSON.parse(text);
          output.textContent = JSON.stringify(json, null, 2);
        } catch {
          output.textContent = text;
        }
      } catch (err) {
        statusEl.className = 'status err';
        statusEl.textContent = 'Error';
        output.textContent = 'Error: ' + (err?.message || String(err));
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Upload & Ingest';
      }
    });
  </script>
</body>
</html>
